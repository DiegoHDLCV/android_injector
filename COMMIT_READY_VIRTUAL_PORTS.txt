â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
COMMIT MESSAGE - READY TO USE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[DIEGOH][AI-75] Implementar soporte de puertos virtuales Linux en Aisino

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

DESCRIPCIÃ“N:

Reescribir AisinoComController para soportar puertos virtuales Linux (ttyUSB0,
ttyACM0, ttyGS0) con fallback automÃ¡tico a Rs232Api, siguiendo la estrategia de
NewPOS para resolver el conflicto de acceso simultaneo en Aisino-Aisino.

CAMBIOS PRINCIPALES:

âœ¨ NUEVO: Soporte de puertos virtuales Linux
  - Intenta ttyUSB0 (USB CDC virtual)
  - Intenta ttyACM0 (USB ACM virtual)
  - Intenta ttyGS0 (USB Gadget Serial virtual)
  - Fallback a Rs232Api.PortOpen_Api() si todos fallan

ğŸ”§ MODIFICADO: AisinoComController.kt
  - LÃ­neas 42-46: DefiniciÃ³n de VIRTUAL_PORTS
  - LÃ­neas 55-59: Variables para manejo de streams virtuales
  - LÃ­neas 108-181: MÃ©todo open() con dual-path (virtual + fallback)
  - LÃ­neas 228-258: MÃ©todo write() con dual-path
  - LÃ­neas 260-297: MÃ©todo readData() con dual-path
  - LÃ­neas 183-226: MÃ©todo close() con dual-path

PROBLEMA RESUELTO:

âŒ ANTES: Aisino-Aisino falla porque ambos acceden exclusivamente a Puerto 0
âœ… DESPUÃ‰S: Virtuales permiten acceso compartido (mÃºltiples procesos simultÃ¡neamente)

VENTAJAS:

1. Aisino-Aisino comunicaciÃ³n ahora puede ser paralela (no secuencial)
2. Compatible hacia atrÃ¡s - fallback automÃ¡tico a Rs232Api si virtuales no disponibles
3. Refleja la estrategia de NewPOS que ya funciona correctamente
4. Logs detallados mostrando quÃ© puerto estÃ¡ siendo utilizado

ARQUITECTURA:

Intento de Puertos Virtuales
    â†“
    â”œâ”€ /dev/ttyUSB0 â†’ InputStream/OutputStream
    â”œâ”€ /dev/ttyACM0 â†’ InputStream/OutputStream
    â”œâ”€ /dev/ttyGS0 â†’ InputStream/OutputStream
    â””â”€ (si todos fallan)
        â†“
        Fallback a Rs232Api.PortOpen_Api(comport)

TESTING REQUIRED:

1. Instalar APKs en ambos Aisino
2. Verificar logs de "Puerto virtual abierto" o "fallback Rs232Api"
3. KeyReceiver debe escuchar > 1 minuto sin cierre
4. Injector debe poder enviar mientras KeyReceiver escucha (paralelo)
5. ComunicaciÃ³n bidireccional funcionar correctamente

MÃ‰TRICAS DE Ã‰XITO:

- DuraciÃ³n escucha Aisino-Aisino: > 1 minuto (antes ~22-31s)
- Acceso simultaneo: âœ… funciona (antes âŒ fallaba)
- Logs/minuto: < 200 (antes 100k+ con busy-wait)
- TX Error -1: âŒ no deberÃ­a aparecer
- Aisino-NewPOS: âœ… continÃºa funcionando igual

REFERENCIAS:

- Commits previos:
  * a3d2f86: Fix busy-wait loop (22s â†’ 130s)
  * e2ad536: PortReset despuÃ©s de cierre
  * ee2610d: Revert cable detection pause

- DocumentaciÃ³n:
  * IMPLEMENTATION_VIRTUAL_PORTS.md (detalles tÃ©cnicos)
  * DEPLOYMENT_GUIDE_VIRTUAL_PORTS.md (pasos de despliegue)
  * ANALYSIS_AISINO_PUERTO_COMPARTIDO.md (anÃ¡lisis del problema)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CÃ“MO USAR ESTE COMMIT:

En la terminal, despuÃ©s de hacer git add de los cambios:

    git commit -m "$(cat <<'EOF'
[DIEGOH][AI-75] Implementar soporte de puertos virtuales Linux en Aisino

Reescribir AisinoComController para soportar puertos virtuales Linux
(ttyUSB0, ttyACM0, ttyGS0) con fallback automÃ¡tico a Rs232Api, siguiendo
la estrategia de NewPOS para resolver el conflicto de acceso simultaneo
en Aisino-Aisino.

CAMBIOS PRINCIPALES:
- Nuevo: Soporte de puertos virtuales Linux con intentos secuenciales
- Modificado: AisinoComController.kt con dual-path (virtual + fallback)
- Ventaja: Permite acceso compartido al puerto (mÃºltiples procesos)
- Compatible: Fallback automÃ¡tico a Rs232Api si virtuales no disponibles

PROBLEMA RESUELTO:
- Aisino-Aisino puede ahora comunicar en paralelo (no secuencial)
- Escucha deberÃ­a durar minutos en lugar de 22-31 segundos
- Refleja estrategia de NewPOS que ya funciona correctamente

ğŸ¤– Generated with Claude Code
Co-Authored-By: Claude <noreply@anthropic.com>
EOF
)"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ESTADO ACTUAL:

âœ… CÃ³digo compilado exitosamente
âœ… APKs generadas (27MB cada una)
âœ… AisinoComController.kt actualizado
âœ… DocumentaciÃ³n completa
â³ Siguiente: Instalar APKs y probar en dispositivos reales

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

